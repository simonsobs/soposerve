<style>
  .custom-nav-styles {
    background-color: #dee2e6; /* corresponds to Bootstrap's gray-300 */
    column-gap: 3em;
    row-gap: 0.5em;
  }
</style>

<nav 
  class="border-bottom border-secondary-subtle shadow-sm mb-2 py-2 px-3 d-flex flex-wrap justify-content-between align-items-center custom-nav-styles"
>
    <div class="d-flex align-items-center gap-3">
      <div class="rounded-circle shadow-sm" title="Click to return to home page">
        <a class="nav-link color-light" href="{{ web_root }}">
          <img alt="HIPPO logo" src="{{ web_root }}/static/logo.svg" width="55" height="auto" />
        </a>
      </div>
      <form
        role="search"
        action="{{ web_root }}/search/results"
        method="get"
        style="min-width: 400px; max-width: 750px"
      >
        <div class="rounded input-group input-group-sm shadow-sm">
          <div
            class="position-relative"
            style="height: 40px; min-height: 40px;"
          >
            <label
              class="small position-absolute opacity-50"
              for="search-filter"
              style="top: 2px; left: 10px;"
            >
              Filter by:
            </label>
            <select
              class="form-select form-select-sm rounded-0 rounded-start-2"
              id="search-filter"
              style="height: 100%; padding-top: 15px;"
              name="filter"
              onchange="onFilterChange(event)"
            >
              <option value="products" {% if filter == "products" %}selected{% endif %}>Products</option>
              <option value="collections" {% if filter == "collections" %}selected{% endif %}>Collections</option>
              <option value="users" {% if filter == "users" %}selected{% endif %}>Users</option>
              <option value="sources" {% if filter == "sources" %}selected{% endif %}>Sources</option>
            </select>
          </div>
          <label for="search-bar" class="visually-hidden">Search:</label>
          <input
            class="form-control"
            type="search"
            id="search-bar"
            name="q"
            style="flex-grow: 2;"
            value="{{ '' if query is none else query }}"
          >
          <button class="btn btn-dark btn-sm" type="submit">Search</button>
        </div>
      </form>
    </div>
    <ul class="nav gap-4 align-items-center full-menu flex-nowrap">
      <li class="nav-item">
        <a class="btn btn-outline-dark btn-sm d-flex align-items-center shadow-sm text-nowrap" style="height: 40px;" href="{{ web_root }}/searchmetadata">Search by metadata</a>
      </li>
      <li class="nav-item">
        {% if user %}
          {% if user.avatar_url %}
            <a href="{{ web_root }}/user">
              <img class="border rounded-circle shadow-sm" src="{{ user.avatar_url }}" alt="User's GitHub avatar" width="45" height="auto"/>
            </a>
          {% else %}
            <a class="btn btn-primary btn-sm d-flex align-items-center shadow-sm" style="height: 40px;" href="{{ web_root }}/user">
              My profile
            </a>
          {% endif %}
        {% else %}
          <a class="btn btn-primary btn-sm d-flex align-items-center shadow-sm text-nowrap" style="height: 40px;" href="{{ web_root }}/login">
            Log in
          </a>
        {% endif %}
      </li>
    </ul>
  </nav>

  {% block scripts %}
    <script>
      let selectedFilter = '';
      
      document.addEventListener('DOMContentLoaded', () => {
        if (selectedFilter.length) {
          return;
        } else {
          selectedFilter = 'products';
          setPlaceholder();
        }
      })

      function setPlaceholder() {
        const inputEl = document.querySelector('#search-bar');
        inputEl.placeholder = "Search by " + selectedFilter.substring(0, selectedFilter.length - 1) + " names...";
      }

      function onFilterChange(e) {
        selectedFilter = e.target.value;
        setPlaceholder();
      }

    </script>
  {% endblock %}